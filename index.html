<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvoicePro - Professional Billing Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #4CAF50 0%, #81C784 100%);
            --primary-color: #4CAF50;
            --secondary-color: #81C784;
            --success-color: #4CAF50;
            --warning-color: #FFB74D;
            --danger-color: #E57373;
            --info-color: #64B5F6;
            --cream-color: #FFF8E1;
            --light-blue: #E3F2FD;
            --light-pink: #FCE4EC;
            --light-green: #E8F5E8;
            --border-radius: 12px;
            --box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Professional Color Scheme */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fffe;
            --bg-tertiary: #e8f5e8;
            --text-primary: #2e3440;
            --text-secondary: #5e81ac;
            --text-muted: #81a1c1;
            --border-color: #e5e9f0;
            --card-bg: #ffffff;
            --modal-bg: #ffffff;
            --table-bg: #ffffff;
            --input-bg: #ffffff;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: var(--transition);
            min-height: 100%;
            margin: 0;
            padding: 0;
        }
        
        html, body {
            height: 100%;
        }
        
        .main-container {
            background: var(--bg-primary);
            min-height: 100%;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }
        
        .navbar {
            background: var(--primary-gradient) !important;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 1rem 0;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.75rem;
            color: white !important;
        }
        
        .nav-link {
            font-weight: 500;
            transition: var(--transition);
            color: rgba(255,255,255,0.9) !important;
            border-radius: 8px;
            margin: 0 4px;
            padding: 8px 16px !important;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(255,255,255,0.2);
            color: white !important;
            transform: translateY(-1px);
        }


        
        .card {
            border: none;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            background: var(--card-bg);
            border: 1px solid var(--border-color);
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
        
        .stat-card {
            cursor: pointer;
            position: relative;
            overflow: hidden;
            color: white;
        }

        .stat-card.revenue-card {
            background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%);
        }

        .stat-card.invoice-card {
            background: linear-gradient(135deg, #64B5F6 0%, #90CAF9 100%);
        }

        .stat-card.subscription-card {
            background: linear-gradient(135deg, #FFB74D 0%, #FFCC80 100%);
        }

        .stat-card.pending-card {
            background: linear-gradient(135deg, #F06292 0%, #F48FB1 100%);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .stat-card:hover::before {
            left: 100%;
        }
        
        .stat-card .card-body {
            padding: 2rem;
            position: relative;
            z-index: 1;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-variant-numeric: tabular-nums;
        }

        .stat-description {
            font-size: 0.95rem;
            opacity: 0.9;
            font-weight: 500;
        }

        .stat-icon {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 2rem;
            opacity: 0.3;
        }
        
        .btn {
            border-radius: 10px;
            font-weight: 600;
            transition: var(--transition);
            border: none;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            color: white;
        }

        .btn-outline-primary {
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            background: transparent;
        }

        .btn-outline-primary:hover {
            background: var(--primary-gradient);
            color: white;
            transform: translateY(-2px);
        }
        
        .table {
            border-radius: var(--border-radius);
            overflow: hidden;
            background: var(--table-bg);
            color: var(--text-primary);
        }
        
        .table thead {
            background: var(--primary-gradient);
            color: white;
        }

        .table tbody tr {
            transition: var(--transition);
        }

        .table tbody tr:hover {
            background: var(--bg-secondary);
        }
        
        .badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 500;
            font-size: 0.8rem;
        }

        .badge.bg-success { background: var(--success-color) !important; }
        .badge.bg-warning { background: var(--warning-color) !important; color: #000 !important; }
        .badge.bg-danger { background: var(--danger-color) !important; }
        .badge.bg-secondary { background: var(--text-secondary) !important; }
        
        .modal-content {
            border-radius: var(--border-radius);
            border: none;
            background: var(--modal-bg);
            color: var(--text-primary);
        }
        
        .modal-header {
            background: var(--primary-gradient);
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            border-bottom: none;
        }

        .modal-body {
            background: var(--modal-bg);
        }

        .modal-footer {
            background: var(--modal-bg);
            border-top: 1px solid var(--border-color);
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid var(--border-color);
            transition: var(--transition);
            background: var(--input-bg);
            color: var(--text-primary);
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
            background: var(--input-bg);
            color: var(--text-primary);
        }

        .form-label {
            color: var(--text-primary);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .page-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
            min-height: calc(100vh - 80px);
        }
        
        .page-section.active {
            display: block;
        }

        #dashboard {
            background: var(--light-green);
        }

        #invoices {
            background: var(--light-blue);
        }

        #subscriptions {
            background: var(--cream-color);
        }

        #reports {
            background: var(--light-pink);
        }

        #settings {
            background: var(--bg-secondary);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            margin: 20px 0;
        }
        
        .invoice-preview {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-top: 1rem;
            border: 1px solid var(--border-color);
        }
        
        .company-header {
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }
        
        .invoice-table {
            margin: 2rem 0;
        }
        
        .invoice-total {
            background: var(--primary-gradient);
            color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            text-align: right;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .currency-symbol {
            font-weight: 600;
            color: var(--primary-color);
        }

        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .filter-controls {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            background: var(--card-bg);
            color: var(--text-primary);
        }
        
        @media (max-width: 768px) {
            .stat-number {
                font-size: 2rem;
            }
            
            .card-body {
                padding: 1.5rem;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .navbar-nav {
                margin-top: 1rem;
            }


        }

        @media (max-width: 576px) {
            .stat-card .card-body {
                padding: 1.5rem;
            }

            .stat-number {
                font-size: 1.75rem;
            }

            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container"></div>

    <div class="main-container">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#"><i class="fas fa-receipt me-2"></i>InvoicePro</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showPage('dashboard')" id="nav-dashboard">
                                <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('invoices')" id="nav-invoices">
                                <i class="fas fa-file-invoice me-1"></i>Invoices
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('subscriptions')" id="nav-subscriptions">
                                <i class="fas fa-sync-alt me-1"></i>Subscriptions
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('reports')" id="nav-reports">
                                <i class="fas fa-chart-bar me-1"></i>Reports
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showPage('settings')" id="nav-settings">
                                <i class="fas fa-cog me-1"></i>Settings
                            </a>
                        </li>
                    </ul>
                    <button class="btn btn-outline-light btn-sm" onclick="showPage('dashboard')" id="backToDashboard" style="display: none;">
                        <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
                    </button>
                </div>
            </div>
        </nav>

        <!-- Dashboard Section -->
        <div id="dashboard" class="page-section active">
            <div class="container-fluid p-4">
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-tachometer-alt me-2"></i>Dashboard Overview</h2>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="refreshDashboard()">
                            <i class="fas fa-sync-alt me-1"></i>Refresh
                        </button>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card revenue-card" onclick="showRevenueDetails()">
                            <div class="card-body text-center">
                                <i class="fas fa-dollar-sign stat-icon"></i>
                                <div class="stat-number" id="totalRevenue">$0.00</div>
                                <div class="stat-description">Total Revenue</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card invoice-card" onclick="showInvoicesPage()">
                            <div class="card-body text-center">
                                <i class="fas fa-file-invoice stat-icon"></i>
                                <div class="stat-number" id="totalInvoices">0</div>
                                <div class="stat-description">Total Invoices</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card subscription-card" onclick="showSubscriptionsPage()">
                            <div class="card-body text-center">
                                <i class="fas fa-users stat-icon"></i>
                                <div class="stat-number" id="activeSubscriptions">0</div>
                                <div class="stat-description">Active Subscriptions</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card pending-card" onclick="showPendingInvoices()">
                            <div class="card-body text-center">
                                <i class="fas fa-exclamation-triangle stat-icon"></i>
                                <div class="stat-number" id="pendingInvoices">0</div>
                                <div class="stat-description">Pending Invoices</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title mb-3"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                                <div class="d-flex flex-wrap gap-2">
                                    <button class="btn btn-primary" onclick="showCreateInvoiceModal()">
                                        <i class="fas fa-plus me-1"></i>New Invoice
                                    </button>
                                    <button class="btn btn-primary" onclick="showCreateSubscriptionModal()">
                                        <i class="fas fa-sync-alt me-1"></i>New Subscription
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="showPage('reports')">
                                        <i class="fas fa-chart-line me-1"></i>View Reports
                                    </button>
                                    <button class="btn btn-outline-primary" onclick="exportData()">
                                        <i class="fas fa-download me-1"></i>Export Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="row">
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-clock me-2"></i>Recent Invoices</h5>
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Invoice #</th>
                                                <th>Client</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                                <th>Date</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentInvoicesTable">
                                            <tr>
                                                <td colspan="5" class="text-center text-muted">
                                                    <div class="empty-state">
                                                        <i class="fas fa-file-invoice"></i>
                                                        <p>No invoices yet. Create your first invoice!</p>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-chart-line me-2"></i>Revenue Trend</h5>
                                <div class="chart-container">
                                    <canvas id="revenueChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Invoices Section -->
        <div id="invoices" class="page-section">
            <div class="container-fluid p-4">
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-file-invoice me-2"></i>Invoice Management</h2>
                    <button class="btn btn-primary" onclick="showCreateInvoiceModal()">
                        <i class="fas fa-plus me-1"></i>Create Invoice
                    </button>
                </div>

                <!-- Filter Controls -->
                <div class="filter-controls">
                    <div class="row">
                        <div class="col-md-3">
                            <select class="form-select" id="invoiceStatusFilter" onchange="filterInvoices()">
                                <option value="">All Statuses</option>
                                <option value="pending">Pending</option>
                                <option value="paid">Paid</option>
                                <option value="overdue">Overdue</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" id="invoiceSearchFilter" placeholder="Search client..." onkeyup="filterInvoices()">
                        </div>
                        <div class="col-md-3">
                            <input type="date" class="form-control" id="invoiceDateFilter" onchange="filterInvoices()">
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-outline-primary w-100" onclick="clearInvoiceFilters()">
                                <i class="fas fa-times me-1"></i>Clear Filters
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Invoice #</th>
                                        <th>Client</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Due Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="invoicesTable">
                                    <tr>
                                        <td colspan="7" class="text-center">
                                            <div class="empty-state">
                                                <i class="fas fa-file-invoice"></i>
                                                <p>No invoices created yet</p>
                                                <button class="btn btn-primary" onclick="showCreateInvoiceModal()">
                                                    Create Your First Invoice
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subscriptions Section -->
        <div id="subscriptions" class="page-section">
            <div class="container-fluid p-4">
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-sync-alt me-2"></i>Subscription Management</h2>
                    <button class="btn btn-primary" onclick="showCreateSubscriptionModal()">
                        <i class="fas fa-plus me-1"></i>Create Subscription
                    </button>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Plan Name</th>
                                        <th>Client</th>
                                        <th>Amount</th>
                                        <th>Billing Cycle</th>
                                        <th>Status</th>
                                        <th>Next Billing</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="subscriptionsTable">
                                    <tr>
                                        <td colspan="7" class="text-center">
                                            <div class="empty-state">
                                                <i class="fas fa-sync-alt"></i>
                                                <p>No subscriptions created yet</p>
                                                <button class="btn btn-primary" onclick="showCreateSubscriptionModal()">
                                                    Create Your First Subscription
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="page-section">
            <div class="container-fluid p-4">
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-chart-bar me-2"></i>Reports & Analytics</h2>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary" onclick="exportReports()">
                            <i class="fas fa-download me-1"></i>Export Reports
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h4 class="text-success" id="reportTotalRevenue">$0.00</h4>
                                <p class="text-muted mb-0">Total Revenue</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h4 class="text-primary" id="reportMonthlyRevenue">$0.00</h4>
                                <p class="text-muted mb-0">This Month</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h4 class="text-warning" id="reportPendingAmount">$0.00</h4>
                                <p class="text-muted mb-0">Pending Amount</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h4 class="text-info" id="reportSubscriptionRevenue">$0.00</h4>
                                <p class="text-muted mb-0">Monthly Recurring</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Revenue by Month</h5>
                                <div class="chart-container">
                                    <canvas id="monthlyRevenueChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Revenue by Client</h5>
                                <div class="chart-container">
                                    <canvas id="clientRevenueChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="page-section">
            <div class="container-fluid p-4">
                <div class="section-header">
                    <h2 class="section-title"><i class="fas fa-cog me-2"></i>Settings</h2>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-building me-2"></i>Company Information</h5>
                                <form id="companyForm">
                                    <div class="mb-3">
                                        <label class="form-label">Company Name</label>
                                        <input type="text" class="form-control" id="companyName" value="Your Company Name">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Address</label>
                                        <textarea class="form-control" id="companyAddress" rows="3">123 Business Street, City, State 12345</textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" id="companyEmail" value="contact@yourcompany.com">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Phone</label>
                                        <input type="tel" class="form-control" id="companyPhone" value="+1 (555) 123-4567">
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-1"></i>Save Changes
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-cogs me-2"></i>Business Settings</h5>
                                <form id="businessForm">
                                    <div class="mb-3">
                                        <label class="form-label">Default Currency</label>
                                        <select class="form-select" id="defaultCurrency">
                                            <option value="USD">USD ($)</option>
                                            <option value="EUR">EUR (€)</option>
                                            <option value="GBP">GBP (£)</option>
                                            <option value="INR">INR (₹)</option>
                                            <option value="CAD">CAD (C$)</option>
                                            <option value="AUD">AUD (A$)</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Tax Rate (%)</label>
                                        <input type="number" class="form-control" id="taxRate" value="10" step="0.01" min="0" max="100">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Invoice Prefix</label>
                                        <input type="text" class="form-control" id="invoicePrefix" value="INV">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Date Format</label>
                                        <select class="form-select" id="dateFormat">
                                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-1"></i>Save Settings
                                    </button>
                                </form>
                            </div>
                        </div>

                        <div class="card mt-4">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-database me-2"></i>Data Management</h5>
                                <p class="text-muted">Export your data or reset the application</p>
                                <div class="d-flex flex-wrap gap-2">
                                    <button class="btn btn-outline-primary" onclick="exportData()">
                                        <i class="fas fa-download me-1"></i>Export Data
                                    </button>
                                    <button class="btn btn-outline-warning" onclick="importData()">
                                        <i class="fas fa-upload me-1"></i>Import Data
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="resetData()">
                                        <i class="fas fa-trash me-1"></i>Reset All Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Invoice Modal -->
    <div class="modal fade" id="createInvoiceModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-plus me-2"></i>Create New Invoice</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="invoiceForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Client Name *</label>
                                    <input type="text" class="form-control" id="clientName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Client Email *</label>
                                    <input type="email" class="form-control" id="clientEmail" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Client Address</label>
                            <textarea class="form-control" id="clientAddress" rows="2" placeholder="Enter client address"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Invoice Date *</label>
                                    <input type="date" class="form-control" id="invoiceDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Due Date *</label>
                                    <input type="date" class="form-control" id="dueDate" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0"><i class="fas fa-list me-2"></i>Invoice Items</h6>
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="addInvoiceItem()">
                                <i class="fas fa-plus me-1"></i>Add Item
                            </button>
                        </div>
                        
                        <div id="invoiceItems">
                            <div class="row invoice-item mb-2 align-items-end">
                                <div class="col-md-4">
                                    <label class="form-label">Description</label>
                                    <input type="text" class="form-control" placeholder="Item description" name="description" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Qty</label>
                                    <input type="number" class="form-control" placeholder="1" name="quantity" value="1" min="1" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Rate</label>
                                    <input type="number" class="form-control" placeholder="0.00" name="rate" step="0.01" min="0" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Amount</label>
                                    <input type="text" class="form-control" placeholder="0.00" name="amount" readonly>
                                </div>
                                <div class="col-md-1">
                                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeInvoiceItem(this)" title="Remove item">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-8"></div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Subtotal:</span>
                                            <span><span id="currencySymbol">$</span><span id="invoiceSubtotal">0.00</span></span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Tax (<span id="invoiceTaxRate">10</span>%):</span>
                                            <span><span id="currencySymbolTax">$</span><span id="invoiceTax">0.00</span></span>
                                        </div>
                                        <hr>
                                        <div class="d-flex justify-content-between">
                                            <strong>Total:</strong>
                                            <strong><span id="currencySymbolTotal">$</span><span id="invoiceTotal">0.00</span></strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createInvoice()">
                        <i class="fas fa-save me-1"></i>Create Invoice
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Subscription Modal -->
    <div class="modal fade" id="createSubscriptionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-plus me-2"></i>Create New Subscription</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="subscriptionForm">
                        <div class="mb-3">
                            <label class="form-label">Plan Name *</label>
                            <input type="text" class="form-control" id="planName" placeholder="e.g., Basic Plan, Premium Plan" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Client Name *</label>
                            <input type="text" class="form-control" id="subClientName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Client Email *</label>
                            <input type="email" class="form-control" id="subClientEmail" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Amount *</label>
                                    <div class="input-group">
                                        <span class="input-group-text" id="subCurrencySymbol">$</span>
                                        <input type="number" class="form-control" id="subAmount" step="0.01" min="0" required>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Billing Cycle *</label>
                                    <select class="form-select" id="billingCycle" required>
                                        <option value="monthly">Monthly</option>
                                        <option value="quarterly">Quarterly (3 months)</option>
                                        <option value="yearly">Yearly</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Start Date *</label>
                            <input type="date" class="form-control" id="startDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="subDescription" rows="2" placeholder="Optional description of the subscription"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createSubscription()">
                        <i class="fas fa-save me-1"></i>Create Subscription
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Preview Modal -->
    <div class="modal fade" id="invoicePreviewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-eye me-2"></i>Invoice Preview</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="invoicePreviewContent"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="printInvoice()">
                        <i class="fas fa-print me-1"></i>Print Invoice
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for import -->
    <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="handleFileImport(event)">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Application State
        let appData = {
            invoices: [],
            subscriptions: [],
            settings: {
                companyName: 'Your Company Name',
                companyAddress: '123 Business Street, City, State 12345',
                companyEmail: 'contact@yourcompany.com',
                companyPhone: '+1 (555) 123-4567',
                currency: 'USD',
                taxRate: 10,
                invoicePrefix: 'INV',
                dateFormat: 'MM/DD/YYYY'
            }
        };

        // Currency symbols mapping
        const currencySymbols = {
            'USD': '$',
            'EUR': '€',
            'GBP': '£',
            'INR': '₹',
            'CAD': 'C$',
            'AUD': 'A$'
        };

        // Charts storage
        let charts = {};

        // Load data from localStorage
        function loadData() {
            try {
                const saved = localStorage.getItem('invoiceProData');
                if (saved) {
                    const parsedData = JSON.parse(saved);
                    appData = { ...appData, ...parsedData };
                    
                    // Ensure settings exist
                    if (!appData.settings) {
                        appData.settings = {
                            companyName: 'Your Company Name',
                            companyAddress: '123 Business Street, City, State 12345',
                            companyEmail: 'contact@yourcompany.com',
                            companyPhone: '+1 (555) 123-4567',
                            currency: 'USD',
                            taxRate: 10,
                            invoicePrefix: 'INV',
                            dateFormat: 'MM/DD/YYYY'
                        };
                    }
                }
                
                updateDashboard();
                updateAllTables();
                updateReports();
                loadSettingsToForm();
                updateCurrencySymbols();
                
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Error loading data', 'error');
            }
        }

        // Save data to localStorage
        function saveData() {
            try {
                localStorage.setItem('invoiceProData', JSON.stringify(appData));
            } catch (error) {
                console.error('Error saving data:', error);
                showToast('Error saving data', 'error');
            }
        }

        // Professional theme is always active - no theme switching needed

        // Toast notifications
        function showToast(message, type = 'success') {
            const toastContainer = document.querySelector('.toast-container');
            const toastId = 'toast-' + Date.now();
            
            const bgClass = type === 'success' ? 'bg-success' : type === 'error' ? 'bg-danger' : 'bg-info';
            
            const toastHTML = `
                <div class="toast" id="${toastId}" role="alert">
                    <div class="toast-header ${bgClass} text-white">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} me-2"></i>
                        <strong class="me-auto">${type === 'success' ? 'Success' : type === 'error' ? 'Error' : 'Info'}</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, { delay: 4000 });
            toast.show();
            
            // Remove toast element after it's hidden
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        }

        // Navigation
        function showPage(pageId) {
            // Hide all sections
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(pageId).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.getElementById(`nav-${pageId}`).classList.add('active');

            // Show/hide back to dashboard button
            const backButton = document.getElementById('backToDashboard');
            if (pageId === 'dashboard') {
                backButton.style.display = 'none';
            } else {
                backButton.style.display = 'inline-block';
            }

            // Update page-specific content
            if (pageId === 'reports') {
                setTimeout(updateReports, 100);
            } else if (pageId === 'invoices') {
                updateInvoicesTable();
            } else if (pageId === 'subscriptions') {
                updateSubscriptionsTable();
            } else if (pageId === 'dashboard') {
                setTimeout(updateDashboard, 100);
            }
        }

        // Dashboard stat card click handlers
        function showRevenueDetails() {
            showPage('reports');
            showToast('Showing detailed revenue reports', 'info');
        }

        function showInvoicesPage() {
            showPage('invoices');
        }

        function showSubscriptionsPage() {
            showPage('subscriptions');
        }

        function showPendingInvoices() {
            showPage('invoices');
            // Filter to show only pending invoices
            document.getElementById('invoiceStatusFilter').value = 'pending';
            filterInvoices();
            showToast('Filtered to show pending invoices', 'info');
        }

        // Currency symbol updates
        function updateCurrencySymbols() {
            const symbol = currencySymbols[appData.settings.currency] || '$';
            
            // Update all currency symbols in the UI
            document.querySelectorAll('#currencySymbol, #currencySymbolTax, #currencySymbolTotal').forEach(el => {
                el.textContent = symbol;
            });
            
            document.querySelectorAll('#subCurrencySymbol').forEach(el => {
                el.textContent = symbol;
            });
        }

        // Format currency
        function formatCurrency(amount) {
            const symbol = currencySymbols[appData.settings.currency] || '$';
            return `${symbol}${parseFloat(amount || 0).toFixed(2)}`;
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            const format = appData.settings.dateFormat || 'MM/DD/YYYY';
            
            switch (format) {
                case 'DD/MM/YYYY':
                    return date.toLocaleDateString('en-GB');
                case 'YYYY-MM-DD':
                    return date.toISOString().split('T')[0];
                default:
                    return date.toLocaleDateString('en-US');
            }
        }

        // Dashboard Updates
        function updateDashboard() {
            try {
                const totalRevenue = appData.invoices
                    .filter(inv => inv.status === 'paid')
                    .reduce((sum, inv) => sum + (inv.total || 0), 0);
                
                const pendingInvoicesCount = appData.invoices.filter(inv => inv.status === 'pending').length;
                const activeSubscriptionsCount = appData.subscriptions.filter(sub => sub.status === 'active').length;

                document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
                document.getElementById('totalInvoices').textContent = appData.invoices.length;
                document.getElementById('activeSubscriptions').textContent = activeSubscriptionsCount;
                document.getElementById('pendingInvoices').textContent = pendingInvoicesCount;

                updateRecentInvoicesTable();
                updateDashboardChart();
                
            } catch (error) {
                console.error('Error updating dashboard:', error);
            }
        }

        function updateRecentInvoicesTable() {
            const tbody = document.getElementById('recentInvoicesTable');
            const recentInvoices = appData.invoices.slice(-5).reverse();
            
            if (recentInvoices.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center">
                            <div class="empty-state">
                                <i class="fas fa-file-invoice"></i>
                                <p>No invoices yet. Create your first invoice!</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = recentInvoices.map(invoice => `
                <tr>
                    <td><strong>${invoice.number}</strong></td>
                    <td>${invoice.clientName}</td>
                    <td>${formatCurrency(invoice.total)}</td>
                    <td><span class="badge bg-${getStatusColor(invoice.status)}">${invoice.status.toUpperCase()}</span></td>
                    <td>${formatDate(invoice.date)}</td>
                </tr>
            `).join('');
        }

        function updateDashboardChart() {
            const ctx = document.getElementById('revenueChart');
            if (!ctx) return;
            
            // Destroy existing chart
            if (charts.dashboard) {
                charts.dashboard.destroy();
            }

            const monthlyData = getMonthlyRevenueData();
            
            // Check if we have data
            if (monthlyData.data.every(val => val === 0)) {
                // Show empty state
                const container = ctx.parentElement;
                container.innerHTML = `
                    <div class="d-flex align-items-center justify-content-center h-100">
                        <div class="text-center text-muted">
                            <i class="fas fa-chart-line fa-3x mb-3" style="opacity: 0.3;"></i>
                            <p>No revenue data yet</p>
                            <small>Create and mark invoices as paid to see trends</small>
                        </div>
                    </div>
                `;
                return;
            }
            
            charts.dashboard = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthlyData.labels,
                    datasets: [{
                        label: 'Revenue',
                        data: monthlyData.data,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#4CAF50',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function refreshDashboard() {
            showToast('Dashboard refreshed', 'success');
            updateDashboard();
        }

        // Invoice Management
        function showCreateInvoiceModal() {
            // Set default dates
            document.getElementById('invoiceDate').value = new Date().toISOString().split('T')[0];
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 30);
            document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
            
            // Update tax rate and currency symbols
            document.getElementById('invoiceTaxRate').textContent = appData.settings.taxRate;
            updateCurrencySymbols();
            
            // Reset form
            document.getElementById('invoiceForm').reset();
            resetInvoiceItems();
            
            new bootstrap.Modal(document.getElementById('createInvoiceModal')).show();
        }

        function resetInvoiceItems() {
            document.getElementById('invoiceItems').innerHTML = `
                <div class="row invoice-item mb-2 align-items-end">
                    <div class="col-md-4">
                        <label class="form-label">Description</label>
                        <input type="text" class="form-control" placeholder="Item description" name="description" required>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Qty</label>
                        <input type="number" class="form-control" placeholder="1" name="quantity" value="1" min="1" required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Rate</label>
                        <input type="number" class="form-control" placeholder="0.00" name="rate" step="0.01" min="0" required>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Amount</label>
                        <input type="text" class="form-control" placeholder="0.00" name="amount" readonly>
                    </div>
                    <div class="col-md-1">
                        <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeInvoiceItem(this)" title="Remove item">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            attachInvoiceItemListeners();
        }

        function addInvoiceItem() {
            const container = document.getElementById('invoiceItems');
            const newItem = document.createElement('div');
            newItem.className = 'row invoice-item mb-2 align-items-end';
            newItem.innerHTML = `
                <div class="col-md-4">
                    <input type="text" class="form-control" placeholder="Item description" name="description" required>
                </div>
                <div class="col-md-2">
                    <input type="number" class="form-control" placeholder="1" name="quantity" value="1" min="1" required>
                </div>
                <div class="col-md-3">
                    <input type="number" class="form-control" placeholder="0.00" name="rate" step="0.01" min="0" required>
                </div>
                <div class="col-md-2">
                    <input type="text" class="form-control" placeholder="0.00" name="amount" readonly>
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-outline-danger btn-sm" onclick="removeInvoiceItem(this)" title="Remove item">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            container.appendChild(newItem);
            attachInvoiceItemListeners(newItem);
        }

        function removeInvoiceItem(button) {
            const items = document.querySelectorAll('.invoice-item');
            if (items.length > 1) {
                button.closest('.invoice-item').remove();
                calculateInvoiceTotal();
            } else {
                showToast('At least one item is required', 'error');
            }
        }

        function attachInvoiceItemListeners(container = null) {
            const items = container ? [container] : document.querySelectorAll('.invoice-item');
            
            items.forEach(item => {
                const qtyInput = item.querySelector('input[name="quantity"]');
                const rateInput = item.querySelector('input[name="rate"]');
                
                if (qtyInput && rateInput) {
                    qtyInput.addEventListener('input', calculateInvoiceTotal);
                    rateInput.addEventListener('input', calculateInvoiceTotal);
                }
            });
        }

        function calculateInvoiceTotal() {
            let subtotal = 0;
            
            document.querySelectorAll('.invoice-item').forEach(item => {
                const qty = parseFloat(item.querySelector('input[name="quantity"]').value) || 0;
                const rate = parseFloat(item.querySelector('input[name="rate"]').value) || 0;
                const amount = qty * rate;
                
                item.querySelector('input[name="amount"]').value = amount.toFixed(2);
                subtotal += amount;
            });

            const taxRate = appData.settings.taxRate / 100;
            const tax = subtotal * taxRate;
            const total = subtotal + tax;

            document.getElementById('invoiceSubtotal').textContent = subtotal.toFixed(2);
            document.getElementById('invoiceTax').textContent = tax.toFixed(2);
            document.getElementById('invoiceTotal').textContent = total.toFixed(2);
        }

        function createInvoice() {
            const form = document.getElementById('invoiceForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            try {
                const items = [];
                let hasValidItems = false;
                
                document.querySelectorAll('.invoice-item').forEach(item => {
                    const description = item.querySelector('input[name="description"]').value.trim();
                    const quantity = parseFloat(item.querySelector('input[name="quantity"]').value);
                    const rate = parseFloat(item.querySelector('input[name="rate"]').value);
                    
                    if (description && quantity > 0 && rate >= 0) {
                        items.push({
                            description,
                            quantity,
                            rate,
                            amount: quantity * rate
                        });
                        hasValidItems = true;
                    }
                });

                if (!hasValidItems) {
                    showToast('Please add at least one valid invoice item', 'error');
                    return;
                }

                const subtotal = items.reduce((sum, item) => sum + item.amount, 0);
                const tax = subtotal * (appData.settings.taxRate / 100);
                const total = subtotal + tax;

                const invoice = {
                    id: Date.now(),
                    number: `${appData.settings.invoicePrefix}-${String(appData.invoices.length + 1).padStart(4, '0')}`,
                    clientName: document.getElementById('clientName').value.trim(),
                    clientEmail: document.getElementById('clientEmail').value.trim(),
                    clientAddress: document.getElementById('clientAddress').value.trim(),
                    date: document.getElementById('invoiceDate').value,
                    dueDate: document.getElementById('dueDate').value,
                    items,
                    subtotal,
                    tax,
                    total,
                    status: 'pending',
                    currency: appData.settings.currency,
                    createdAt: new Date().toISOString()
                };

                appData.invoices.push(invoice);
                saveData();
                updateDashboard();
                updateAllTables();

                bootstrap.Modal.getInstance(document.getElementById('createInvoiceModal')).hide();
                showToast(`Invoice ${invoice.number} created successfully!`, 'success');
                
            } catch (error) {
                console.error('Error creating invoice:', error);
                showToast('Error creating invoice', 'error');
            }
        }

        // Subscription Management
        function showCreateSubscriptionModal() {
            document.getElementById('startDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('subscriptionForm').reset();
            updateCurrencySymbols();
            
            new bootstrap.Modal(document.getElementById('createSubscriptionModal')).show();
        }

        function createSubscription() {
            const form = document.getElementById('subscriptionForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            try {
                const subscription = {
                    id: Date.now(),
                    planName: document.getElementById('planName').value.trim(),
                    clientName: document.getElementById('subClientName').value.trim(),
                    clientEmail: document.getElementById('subClientEmail').value.trim(),
                    amount: parseFloat(document.getElementById('subAmount').value),
                    billingCycle: document.getElementById('billingCycle').value,
                    startDate: document.getElementById('startDate').value,
                    description: document.getElementById('subDescription').value.trim(),
                    nextBilling: calculateNextBilling(document.getElementById('startDate').value, document.getElementById('billingCycle').value),
                    status: 'active',
                    currency: appData.settings.currency,
                    createdAt: new Date().toISOString()
                };

                appData.subscriptions.push(subscription);
                saveData();
                updateDashboard();
                updateAllTables();

                bootstrap.Modal.getInstance(document.getElementById('createSubscriptionModal')).hide();
                showToast(`Subscription "${subscription.planName}" created successfully!`, 'success');
                
            } catch (error) {
                console.error('Error creating subscription:', error);
                showToast('Error creating subscription', 'error');
            }
        }

        function calculateNextBilling(startDate, cycle) {
            const date = new Date(startDate);
            switch (cycle) {
                case 'monthly':
                    date.setMonth(date.getMonth() + 1);
                    break;
                case 'quarterly':
                    date.setMonth(date.getMonth() + 3);
                    break;
                case 'yearly':
                    date.setFullYear(date.getFullYear() + 1);
                    break;
            }
            return date.toISOString().split('T')[0];
        }

        // Table Updates
        function updateAllTables() {
            updateInvoicesTable();
            updateSubscriptionsTable();
        }

        function updateInvoicesTable() {
            const tbody = document.getElementById('invoicesTable');
            let invoices = [...appData.invoices];
            
            // Apply filters
            const statusFilter = document.getElementById('invoiceStatusFilter')?.value;
            const searchFilter = document.getElementById('invoiceSearchFilter')?.value.toLowerCase();
            const dateFilter = document.getElementById('invoiceDateFilter')?.value;
            
            if (statusFilter) {
                invoices = invoices.filter(inv => inv.status === statusFilter);
            }
            
            if (searchFilter) {
                invoices = invoices.filter(inv => 
                    inv.clientName.toLowerCase().includes(searchFilter) ||
                    inv.clientEmail.toLowerCase().includes(searchFilter) ||
                    inv.number.toLowerCase().includes(searchFilter)
                );
            }
            
            if (dateFilter) {
                invoices = invoices.filter(inv => inv.date === dateFilter);
            }
            
            if (invoices.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">
                            <div class="empty-state">
                                <i class="fas fa-file-invoice"></i>
                                <p>${appData.invoices.length === 0 ? 'No invoices created yet' : 'No invoices match your filters'}</p>
                                ${appData.invoices.length === 0 ? '<button class="btn btn-primary" onclick="showCreateInvoiceModal()">Create Your First Invoice</button>' : ''}
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = invoices.map(invoice => `
                <tr>
                    <td><strong>${invoice.number}</strong></td>
                    <td>
                        <div>
                            <strong>${invoice.clientName}</strong>
                            <br><small class="text-muted">${invoice.clientEmail}</small>
                        </div>
                    </td>
                    <td><strong>${formatCurrency(invoice.total)}</strong></td>
                    <td><span class="badge bg-${getStatusColor(invoice.status)}">${invoice.status.toUpperCase()}</span></td>
                    <td>${formatDate(invoice.date)}</td>
                    <td>${formatDate(invoice.dueDate)}</td>
                    <td>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-primary" onclick="viewInvoice(${invoice.id})" title="View Invoice">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success" onclick="markAsPaid(${invoice.id})" ${invoice.status === 'paid' ? 'disabled' : ''} title="Mark as Paid">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteInvoice(${invoice.id})" title="Delete Invoice">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function updateSubscriptionsTable() {
            const tbody = document.getElementById('subscriptionsTable');
            
            if (appData.subscriptions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center">
                            <div class="empty-state">
                                <i class="fas fa-sync-alt"></i>
                                <p>No subscriptions created yet</p>
                                <button class="btn btn-primary" onclick="showCreateSubscriptionModal()">Create Your First Subscription</button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = appData.subscriptions.map(sub => `
                <tr>
                    <td>
                        <strong>${sub.planName}</strong>
                        ${sub.description ? `<br><small class="text-muted">${sub.description}</small>` : ''}
                    </td>
                    <td>
                        <div>
                            <strong>${sub.clientName}</strong>
                            <br><small class="text-muted">${sub.clientEmail}</small>
                        </div>
                    </td>
                    <td><strong>${formatCurrency(sub.amount)}</strong></td>
                    <td><span class="badge bg-info">${sub.billingCycle.toUpperCase()}</span></td>
                    <td><span class="badge bg-${getStatusColor(sub.status)}">${sub.status.toUpperCase()}</span></td>
                    <td>${formatDate(sub.nextBilling)}</td>
                    <td>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-warning" onclick="toggleSubscription(${sub.id})" title="${sub.status === 'active' ? 'Pause' : 'Activate'} Subscription">
                                <i class="fas fa-${sub.status === 'active' ? 'pause' : 'play'}"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteSubscription(${sub.id})" title="Delete Subscription">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Filter functions
        function filterInvoices() {
            updateInvoicesTable();
        }

        function clearInvoiceFilters() {
            document.getElementById('invoiceStatusFilter').value = '';
            document.getElementById('invoiceSearchFilter').value = '';
            document.getElementById('invoiceDateFilter').value = '';
            updateInvoicesTable();
            showToast('Filters cleared', 'info');
        }

        // Utility Functions
        function getStatusColor(status) {
            switch (status) {
                case 'paid': return 'success';
                case 'pending': return 'warning';
                case 'overdue': return 'danger';
                case 'active': return 'success';
                case 'paused': return 'secondary';
                default: return 'secondary';
            }
        }

        function markAsPaid(invoiceId) {
            try {
                const invoice = appData.invoices.find(inv => inv.id === invoiceId);
                if (invoice && invoice.status !== 'paid') {
                    invoice.status = 'paid';
                    invoice.paidDate = new Date().toISOString();
                    saveData();
                    updateDashboard();
                    updateAllTables();
                    showToast(`Invoice ${invoice.number} marked as paid!`, 'success');
                }
            } catch (error) {
                console.error('Error marking invoice as paid:', error);
                showToast('Error updating invoice status', 'error');
            }
        }

        function deleteInvoice(invoiceId) {
            const invoice = appData.invoices.find(inv => inv.id === invoiceId);
            if (!invoice) return;
            
            if (confirm(`Are you sure you want to delete invoice ${invoice.number}?`)) {
                try {
                    appData.invoices = appData.invoices.filter(inv => inv.id !== invoiceId);
                    saveData();
                    updateDashboard();
                    updateAllTables();
                    showToast(`Invoice ${invoice.number} deleted successfully`, 'success');
                } catch (error) {
                    console.error('Error deleting invoice:', error);
                    showToast('Error deleting invoice', 'error');
                }
            }
        }

        function toggleSubscription(subId) {
            try {
                const subscription = appData.subscriptions.find(sub => sub.id === subId);
                if (subscription) {
                    const newStatus = subscription.status === 'active' ? 'paused' : 'active';
                    subscription.status = newStatus;
                    saveData();
                    updateDashboard();
                    updateAllTables();
                    showToast(`Subscription ${newStatus === 'active' ? 'activated' : 'paused'}`, 'success');
                }
            } catch (error) {
                console.error('Error toggling subscription:', error);
                showToast('Error updating subscription', 'error');
            }
        }

        function deleteSubscription(subId) {
            const subscription = appData.subscriptions.find(sub => sub.id === subId);
            if (!subscription) return;
            
            if (confirm(`Are you sure you want to delete the subscription "${subscription.planName}"?`)) {
                try {
                    appData.subscriptions = appData.subscriptions.filter(sub => sub.id !== subId);
                    saveData();
                    updateDashboard();
                    updateAllTables();
                    showToast(`Subscription "${subscription.planName}" deleted successfully`, 'success');
                } catch (error) {
                    console.error('Error deleting subscription:', error);
                    showToast('Error deleting subscription', 'error');
                }
            }
        }

        function viewInvoice(invoiceId) {
            const invoice = appData.invoices.find(inv => inv.id === invoiceId);
            if (!invoice) return;

            const content = `
                <div class="invoice-preview">
                    <div class="company-header">
                        <div class="row">
                            <div class="col-md-6">
                                <h3>${appData.settings.companyName}</h3>
                                <p class="mb-0">${appData.settings.companyAddress}</p>
                                <p class="mb-0">${appData.settings.companyEmail}</p>
                                <p class="mb-0">${appData.settings.companyPhone}</p>
                            </div>
                            <div class="col-md-6 text-end">
                                <h2 class="text-primary">INVOICE</h2>
                                <p class="mb-1"><strong>Invoice #:</strong> ${invoice.number}</p>
                                <p class="mb-1"><strong>Date:</strong> ${formatDate(invoice.date)}</p>
                                <p class="mb-0"><strong>Due Date:</strong> ${formatDate(invoice.dueDate)}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5>Bill To:</h5>
                            <p class="mb-1"><strong>${invoice.clientName}</strong></p>
                            <p class="mb-1">${invoice.clientEmail}</p>
                            ${invoice.clientAddress ? `<p class="mb-0">${invoice.clientAddress}</p>` : ''}
                        </div>
                        <div class="col-md-6 text-end">
                            <span class="badge bg-${getStatusColor(invoice.status)} fs-6">${invoice.status.toUpperCase()}</span>
                        </div>
                    </div>
                    
                    <div class="invoice-table">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Description</th>
                                    <th class="text-center">Qty</th>
                                    <th class="text-end">Rate</th>
                                    <th class="text-end">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${invoice.items.map(item => `
                                    <tr>
                                        <td>${item.description}</td>
                                        <td class="text-center">${item.quantity}</td>
                                        <td class="text-end">${formatCurrency(item.rate)}</td>
                                        <td class="text-end">${formatCurrency(item.amount)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-8"></div>
                        <div class="col-md-4">
                            <div class="invoice-total">
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Subtotal:</span>
                                    <span>${formatCurrency(invoice.subtotal)}</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Tax (${appData.settings.taxRate}%):</span>
                                    <span>${formatCurrency(invoice.tax)}</span>
                                </div>
                                <hr class="my-2">
                                <div class="d-flex justify-content-between">
                                    <strong>Total:</strong>
                                    <strong>${formatCurrency(invoice.total)}</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('invoicePreviewContent').innerHTML = content;
            new bootstrap.Modal(document.getElementById('invoicePreviewModal')).show();
        }

        function printInvoice() {
            const content = document.getElementById('invoicePreviewContent').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Invoice</title>
                        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
                        <style>
                            body { padding: 20px; font-family: Arial, sans-serif; }
                            .invoice-preview { background: white !important; }
                            .invoice-total { background: #667eea !important; color: white !important; }
                            @media print {
                                body { margin: 0; }
                                .invoice-preview { box-shadow: none !important; border: none !important; }
                            }
                        </style>
                    </head>
                    <body>${content}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Reports
        function updateReports() {
            updateReportSummary();
            updateMonthlyRevenueChart();
            updateClientRevenueChart();
        }

        function updateReportSummary() {
            try {
                const totalRevenue = appData.invoices
                    .filter(inv => inv.status === 'paid')
                    .reduce((sum, inv) => sum + (inv.total || 0), 0);
                
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                const monthlyRevenue = appData.invoices
                    .filter(inv => {
                        const invDate = new Date(inv.date);
                        return inv.status === 'paid' && 
                               invDate.getMonth() === currentMonth && 
                               invDate.getFullYear() === currentYear;
                    })
                    .reduce((sum, inv) => sum + (inv.total || 0), 0);
                
                const pendingAmount = appData.invoices
                    .filter(inv => inv.status === 'pending')
                    .reduce((sum, inv) => sum + (inv.total || 0), 0);
                
                const subscriptionRevenue = appData.subscriptions
                    .filter(sub => sub.status === 'active')
                    .reduce((sum, sub) => sum + (sub.amount || 0), 0);

                document.getElementById('reportTotalRevenue').textContent = formatCurrency(totalRevenue);
                document.getElementById('reportMonthlyRevenue').textContent = formatCurrency(monthlyRevenue);
                document.getElementById('reportPendingAmount').textContent = formatCurrency(pendingAmount);
                document.getElementById('reportSubscriptionRevenue').textContent = formatCurrency(subscriptionRevenue);
                
            } catch (error) {
                console.error('Error updating report summary:', error);
            }
        }

        function getMonthlyRevenueData() {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const currentYear = new Date().getFullYear();
            const data = new Array(12).fill(0);

            appData.invoices
                .filter(inv => inv.status === 'paid' && new Date(inv.date).getFullYear() === currentYear)
                .forEach(inv => {
                    const month = new Date(inv.date).getMonth();
                    data[month] += inv.total || 0;
                });

            return {
                labels: months,
                data: data
            };
        }

        function updateMonthlyRevenueChart() {
            const ctx = document.getElementById('monthlyRevenueChart');
            if (!ctx) return;
            
            if (charts.monthly) {
                charts.monthly.destroy();
            }

            const monthlyData = getMonthlyRevenueData();
            
            // Check if we have data
            if (monthlyData.data.every(val => val === 0)) {
                // Show empty state
                const container = ctx.parentElement;
                container.innerHTML = `
                    <div class="d-flex align-items-center justify-content-center h-100">
                        <div class="text-center text-muted">
                            <i class="fas fa-chart-bar fa-3x mb-3" style="opacity: 0.3;"></i>
                            <p>No monthly revenue data</p>
                            <small>Create and mark invoices as paid to see monthly trends</small>
                        </div>
                    </div>
                `;
                return;
            }
            
            charts.monthly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthlyData.labels,
                    datasets: [{
                        label: 'Revenue',
                        data: monthlyData.data,
                        backgroundColor: 'rgba(100, 181, 246, 0.8)',
                        borderColor: '#64B5F6',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateClientRevenueChart() {
            const ctx = document.getElementById('clientRevenueChart');
            if (!ctx) return;
            
            if (charts.client) {
                charts.client.destroy();
            }

            const clientData = {};
            appData.invoices
                .filter(inv => inv.status === 'paid')
                .forEach(inv => {
                    clientData[inv.clientName] = (clientData[inv.clientName] || 0) + (inv.total || 0);
                });

            const sortedClients = Object.entries(clientData)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5); // Top 5 clients

            const labels = sortedClients.map(([client]) => client);
            const data = sortedClients.map(([,revenue]) => revenue);
            
            if (labels.length === 0) {
                // Show empty state
                const container = ctx.parentElement;
                container.innerHTML = `
                    <div class="d-flex align-items-center justify-content-center h-100">
                        <div class="text-center text-muted">
                            <i class="fas fa-chart-pie fa-3x mb-3" style="opacity: 0.3;"></i>
                            <p>No client revenue data</p>
                            <small>Create and mark invoices as paid to see client breakdown</small>
                        </div>
                    </div>
                `;
                return;
            }
            
            charts.client = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#4CAF50',
                            '#64B5F6',
                            '#FFB74D',
                            '#F06292',
                            '#9C27B0'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + formatCurrency(context.parsed);
                                }
                            }
                        }
                    }
                }
            });
        }

        function exportReports() {
            try {
                const reportData = {
                    summary: {
                        totalRevenue: appData.invoices.filter(inv => inv.status === 'paid').reduce((sum, inv) => sum + (inv.total || 0), 0),
                        totalInvoices: appData.invoices.length,
                        pendingInvoices: appData.invoices.filter(inv => inv.status === 'pending').length,
                        activeSubscriptions: appData.subscriptions.filter(sub => sub.status === 'active').length
                    },
                    invoices: appData.invoices,
                    subscriptions: appData.subscriptions,
                    generatedAt: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(reportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `invoicepro-reports-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                
                showToast('Reports exported successfully', 'success');
            } catch (error) {
                console.error('Error exporting reports:', error);
                showToast('Error exporting reports', 'error');
            }
        }

        // Settings
        function loadSettingsToForm() {
            try {
                document.getElementById('companyName').value = appData.settings.companyName || '';
                document.getElementById('companyAddress').value = appData.settings.companyAddress || '';
                document.getElementById('companyEmail').value = appData.settings.companyEmail || '';
                document.getElementById('companyPhone').value = appData.settings.companyPhone || '';
                document.getElementById('defaultCurrency').value = appData.settings.currency || 'USD';
                document.getElementById('taxRate').value = appData.settings.taxRate || 10;
                document.getElementById('invoicePrefix').value = appData.settings.invoicePrefix || 'INV';
                document.getElementById('dateFormat').value = appData.settings.dateFormat || 'MM/DD/YYYY';
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        function saveSettings() {
            try {
                // Validate required fields
                const companyName = document.getElementById('companyName').value.trim();
                const companyEmail = document.getElementById('companyEmail').value.trim();
                
                if (!companyName) {
                    showToast('Company name is required', 'error');
                    return;
                }
                
                if (!companyEmail) {
                    showToast('Company email is required', 'error');
                    return;
                }
                
                // Email validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(companyEmail)) {
                    showToast('Please enter a valid email address', 'error');
                    return;
                }
                
                // Tax rate validation
                const taxRate = parseFloat(document.getElementById('taxRate').value);
                if (isNaN(taxRate) || taxRate < 0 || taxRate > 100) {
                    showToast('Tax rate must be between 0 and 100', 'error');
                    return;
                }
                
                // Save settings
                appData.settings.companyName = companyName;
                appData.settings.companyAddress = document.getElementById('companyAddress').value.trim();
                appData.settings.companyEmail = companyEmail;
                appData.settings.companyPhone = document.getElementById('companyPhone').value.trim();
                appData.settings.currency = document.getElementById('defaultCurrency').value;
                appData.settings.taxRate = taxRate;
                appData.settings.invoicePrefix = document.getElementById('invoicePrefix').value.trim() || 'INV';
                appData.settings.dateFormat = document.getElementById('dateFormat').value;
                
                saveData();
                updateCurrencySymbols();
                updateDashboard();
                updateAllTables();
                updateReports();
                
                showToast('Settings saved successfully!', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('Failed to save settings. Please try again.', 'error');
            }
        }

        function exportData() {
            try {
                const dataStr = JSON.stringify(appData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `invoicepro-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                
                showToast('Data exported successfully', 'success');
            } catch (error) {
                console.error('Error exporting data:', error);
                showToast('Error exporting data', 'error');
            }
        }

        function importData() {
            document.getElementById('importFileInput').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate imported data structure
                    if (importedData.invoices && importedData.subscriptions && importedData.settings) {
                        if (confirm('This will replace all current data. Are you sure you want to continue?')) {
                            appData = importedData;
                            saveData();
                            loadData();
                            showToast('Data imported successfully!', 'success');
                        }
                    } else {
                        showToast('Invalid file format', 'error');
                    }
                } catch (error) {
                    console.error('Error importing data:', error);
                    showToast('Error importing data. Please check the file format.', 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        function resetData() {
            if (confirm('Are you sure you want to reset all data? This action cannot be undone.')) {
                if (confirm('This will permanently delete all invoices, subscriptions, and settings. Type "RESET" to confirm.')) {
                    try {
                        localStorage.removeItem('invoiceProData');
                        appData = {
                            invoices: [],
                            subscriptions: [],
                            settings: {
                                companyName: 'Your Company Name',
                                companyAddress: '123 Business Street, City, State 12345',
                                companyEmail: 'contact@yourcompany.com',
                                companyPhone: '+1 (555) 123-4567',
                                currency: 'USD',
                                taxRate: 10,
                                invoicePrefix: 'INV',
                                dateFormat: 'MM/DD/YYYY'
                            }
                        };
                        
                        // Destroy all charts
                        Object.values(charts).forEach(chart => {
                            if (chart) chart.destroy();
                        });
                        charts = {};
                        
                        updateDashboard();
                        updateAllTables();
                        updateReports();
                        loadSettingsToForm();
                        updateCurrencySymbols();
                        
                        showToast('All data has been reset successfully', 'success');
                    } catch (error) {
                        console.error('Error resetting data:', error);
                        showToast('Error resetting data', 'error');
                    }
                }
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            try {
                loadData();
                
                // Attach form listeners
                document.getElementById('companyForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveSettings();
                });
                
                document.getElementById('businessForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveSettings();
                });
                
                // Attach invoice item calculation listeners
                document.addEventListener('input', function(e) {
                    if (e.target.name === 'quantity' || e.target.name === 'rate') {
                        calculateInvoiceTotal();
                    }
                });
                
                // Currency change listener
                document.getElementById('defaultCurrency').addEventListener('change', function() {
                    updateCurrencySymbols();
                });
                
                // Attach initial invoice item listeners
                attachInvoiceItemListeners();
                
                // Update currency symbols on modal show
                document.getElementById('createInvoiceModal').addEventListener('show.bs.modal', function() {
                    updateCurrencySymbols();
                });
                
                document.getElementById('createSubscriptionModal').addEventListener('show.bs.modal', function() {
                    updateCurrencySymbols();
                });
                
            } catch (error) {
                console.error('Error during initialization:', error);
                showToast('Error initializing application', 'error');
            }
        });

        // Handle window resize for charts
        window.addEventListener('resize', function() {
            Object.values(charts).forEach(chart => {
                if (chart) {
                    chart.resize();
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98ee2c676265a7e8',t:'MTc2MDUxOTMyMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
